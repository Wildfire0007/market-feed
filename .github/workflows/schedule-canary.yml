name: Schedule Canary

"on":
  schedule:
    - cron: "2-59/5 * * * *"
  workflow_dispatch:

permissions:
  contents: read

jobs:
  canary:
    runs-on: ubuntu-latest
    steps:
      - name: Emit schedule diagnostics
        env:
          EVENT_NAME: ${{ github.event_name }}
          REF_NAME: ${{ github.ref_name }}
          TIMESTAMP: ${{ github.run_id }}
        run: |
          set -euo pipefail
          ts="$(date -u +%Y-%m-%dT%H:%M:%SZ)"
          default_branch="$(jq -r '.repository.default_branch' "$GITHUB_EVENT_PATH")"
          echo "timestamp=${ts}"
          echo "event_name=${EVENT_NAME}"
          echo "ref_name=${REF_NAME}"
          echo "default_branch=${default_branch}"
          cat > canary.json <<JSON
          {
            "timestamp": "${ts}",
            "event_name": "${EVENT_NAME}",
            "ref_name": "${REF_NAME}",
            "default_branch": "${default_branch}",
            "run_id": "${GITHUB_RUN_ID}"
          }
          JSON

      - name: Upload canary artifact
        uses: actions/upload-artifact@v4
        with:
          name: schedule-canary
          path: canary.json
